!function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,r){"use strict";function n(){return++a+"."+(1e9*Math.random()>>>0)}function o(t){var e=Object.prototype.toString.call(t);return"[object Object]"==e&&t._&&t._.deleted?"[object Deleted]":e}var a=Date.now()%1e9;t.exports={unique_id:n,get_tag:o}},function(t,e,r){window.GState=r(2)},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){var e=Array.isArray(t)?t:t.split(".");if(e.length<1)throw new Error("Invalid key "+t);return e}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];if("[object Object]"!=s(t[n]))return t[n];t=t[n]}return t}function i(t,e,r){if(0==e.length)return r;for(var n=t,o=0;o<e.length-1;o++){var a=e[o];n[a]=n[a]||{},n=n[a]}return n[e[e.length-1]]=r,t}var c=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(0),s=u.get_tag,f=u.unique_id,h=r(3),l=h.clone_obj,v=r(4),b=v.merge_node,d=v.create_node,_=v.delete_path,y=r(5),g=y.create_tracker,j=r(7),p=j.get_query,w=function(){function t(e,r){n(this,t),this.key=r,this.state=e,this._rootNode=e._rootNode,this._watchers=e._watchers,this._readers=e._readers,this._batch_tracker=void 0,this.log=e.debug?console.log:function(){}}return c(t,[{key:"path",value:function(e){return e=o(e),new t(this.state,this.key.concat(e))}},{key:"set",value:function(t){var e=this;if("[object Object]"!=s(t))throw new Error("Value should be an object");var r=this._batch_tracker?this._batch_tracker:g();t=l(this.key,t,r),t=i({},this.key,t),b(this._rootNode,t,this),this._batch_tracker||Object.keys(this._watchers).forEach(function(t){return e._watchers[t].get()})}},{key:"batch",value:function(t){var e=this;this._batch_tracker=g(),t(this),Object.keys(this._watchers).forEach(function(t){return e._watchers[t].get()}),this._batch_tracker=void 0}},{key:"get",value:function(t,e){var r=this;t=i({},this.key,t);var n=p(this._rootNode,t,e,this);return setTimeout(function(){return Object.keys(r._readers).forEach(function(t){return r._readers[t].notify()})}),a(n,this.key)||{}}},{key:"delete",value:function(t){var e=this;t=o(t),t=this.key.concat(t),_(this._rootNode,t,this),this._batch_tracker||Object.keys(this._watchers).forEach(function(t){return e._watchers[t].get()})}},{key:"watch",value:function(t,e){var r=this,n=f(),o=void 0;return this._watchers[n]=function(){o=void 0},this._watchers[n].get=function(){void 0===o&&(o=r.get(t,n),e(o))},this._watchers[n].get(),function(){delete r._watchers[n]}}},{key:"reader",value:function(t,e){var r=this,n=f();t=o(t);var i=a(this._rootNode,this.key.concat(t));if(!i||!i._)throw new Error("Reader should be added into a existed node");i._.readers.add(n);var c=[];return this._readers[n]=function(t,e){c.push(e)},this._readers[n].notify=function(){c.length>0&&e(i,c),c=[]},function(){delete r._readers[n]}}}]),t}(),k=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this._rootNode=d(),this._rootNode._.isRoot=!0,this._watchers={},this._readers={},this.onMapCallback=e.onMapCallback,this.debug=e.debug,this.rootContext=new w(this,[])}return c(t,[{key:"path",value:function(t){return this.rootContext.path(t)}},{key:"set",value:function(t){return this.rootContext.set(t)}},{key:"get",value:function(t,e){return this.rootContext.get(t,e)}},{key:"batch",value:function(t){return this.rootContext.batch(t)}},{key:"reader",value:function(t,e){return this.rootContext.reader(t,e)}},{key:"watch",value:function(t,e){return this.rootContext.watch(t,e)}},{key:"delete",value:function(t){return this.rootContext.delete(t)}}]),t}();t.exports=k},function(t,e,r){"use strict";function n(t){return{_:"ref",path:t}}function o(t,e,r){var n=u(e),o=s[n];if(o)return o(e);if("[object Object]"==n)return i(t,e,r);if("[object Array]"==n)return a(t,e,r);throw new Error("Unsupport value type "+n)}function a(t,e,r){var a=r.getRef(e);if(a)return a;r.setRef(e,n(t));for(var i=[],c=0;c<e.length;c++)i.push(o(t.concat(c),e[c],r));return i}function i(t,e,r){var a=r.getRef(e);if(a)return a;r.setRef(e,n(t));for(var i={},c=Object.keys(e),u=0;u<c.length;u++){var s=c[u];i[s]=o(t.concat(s),e[s],r)}return i}var c=r(0),u=c.get_tag,s={"[object Date]":function(t){return t.toISOString()},"[object Number]":function(t){return t.valueOf()},"[object Boolean]":function(t){return t.valueOf()},"[object Null]":function(t){return t},"[object Undefined]":function(t){return t},"[object String]":function(t){return t.toString()}};t.exports={clone_obj:i}},function(t,e,r){"use strict";function n(t){return t&&"ref"==t._}function o(t){var e={};return Object.defineProperty(e,"_",{value:{isArray:t,watchers:{},readers:new Set},writable:!0}),e}function a(t,e,r){var n=t._.watchers;n[e]=n[e]||new Set,n[e].forEach(function(o){var a=r._watchers[o];"function"!=typeof a?n[e].delete(o):(r.log("Call watcher:",o,"for prop:",e),a(t[e]))})}function i(t,e,r,n){t[e]!==r&&(t[e]=r,a(t,e,n))}function c(t,e){for(var r=e._rootNode,n=0;n<t.length;n++){var a=t[n];if("[object Object]"!=l(r[a])){i(r,a,o(),e)}r=r[a]}return r}function u(t,e,r,a){if(n(r)){return i(t,e,c(r.path,a),a)}var f=l(r);if("[object Object]"==f){var h=t[e];("[object Object]"!=l(h)||h._.isArray)&&(h=o(),i(t,e,h,a)),s(h,r,a)}else if("[object Array]"==f){var v=o(!0);i(t,e,v,a);for(var b=0;b<r.length;b++)u(v,b,r[b],a)}else i(t,e,r,a)}function s(t,e,r){for(var n=Object.keys(e),o=0;o<n.length;o++){var a=n[o];u(t,a,e[a],r)}}function f(t,e,r){for(var n=void 0,o=0;o<e.length-1;o++){if(n=e[o],"[object Object]"!=l(t[n]))return;t=t[n]}if(n=e[e.length-1],"[object Object]"!=l(t[n]))delete t[n],a(t,n,r);else{if(t=t[n],t._.isRoot)return;for(var i=Object.keys(t),c=0;c<i.length;c++)delete t[i[c]],a(t,i[c],r);t._.deleted=!0}}var h=r(0),l=h.get_tag;t.exports={merge_node:s,create_node:o,delete_path:f}},function(t,e,r){"use strict";function n(){var t=c();return{getRef:function(e){var r=a.get(e);if(r&&r[0]==t)return r[1]},setRef:function(e,r){a.set(e,[t,r])}}}var o=r(6),a=new o,i=r(0),c=i.unique_id;t.exports={create_tracker:n}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(0),i=a.unique_id,c=function(){function t(){n(this,t),this.name="__wm-"+i()}return o(t,[{key:"set",value:function(t,e){t.hasOwnProperty(),t.hasOwnProperty(this.name)?t[this.name]=e:Object.defineProperty(t,this.name,{value:e,writable:!0})}},{key:"get",value:function(t){return t[this.name]}},{key:"delete",value:function(t){delete t[this.name]}},{key:"has",value:function(t){return t.hasOwnProperty(this.name)}}]),t}();t.exports=c},function(t,e,r){"use strict";function n(t,e,r,n){for(var a=[],c=Object.keys(t),s=e._,f=0;f<c.length;f++){var h=u(t[c[f]]);"[object Deleted]"!=h&&"[object Null]"!=h&&"[object Undefined]"!=h&&("[object Object]"!=h&&"[object Array]"!=h?a.push(o(t,c[f],r,n)):a.push(i(t[c[f]],s,r,n)))}return"function"==typeof n.state.onMapCallback&&(a=n.state.onMapCallback(e,a)||a),a}function o(t,e,r,n){var o=t._;return r&&(o.watchers[e]=o.watchers[e]||new Set,o.watchers[e].add(r),n.log("Add watcher:",r,"for prop:",e)),o.readers.forEach(function(r){var a=n._readers[r];"function"!=typeof a?o.readers.delete(r):a(t,e)}),t[e]}function a(t,e,r){for(var n={},a=Object.keys(t),i=0;i<a.length;i++){var c=a[i],s=u(t[c]);"[object Deleted]"!=s&&"[object Object]"!=s&&"[object Array]"!=s&&(n[c]=o(t,c,e,r))}return n}function i(t,e,r,c){var s={},f=Object.keys(e);if(1==e||0==f.length)return a(t,r,c);for(var h=0;h<f.length;h++){var l=f[h],v=u(t[l]);if("[object Deleted]"!=v)if("[object Object]"!=v&&"[object Array]"!=v)s[l]=o(t,l,r,c);else{var b=e[l];if(1==b)s[l]=a(t[l],r,c);else{if("[object Object]"!=u(b))throw new Error("Invalid query: "+JSON.stringify(b,null,2));b._?s[l]=n(t[l],b,r,c):s[l]=i(t[l],b,r,c)}}}return s}var c=r(0),u=c.get_tag;t.exports={get_query:i}}]);